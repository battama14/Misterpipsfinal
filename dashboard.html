<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Trading</title>
    <link rel="stylesheet" href="dashboard-clean.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#00d4ff">
    <style>
        html, body, .container { 
            opacity: 1 !important; 
            visibility: visible !important; 
            display: block !important;
        }
        /* Styles de base en attendant le CSS */
        body { font-family: 'Inter', sans-serif; background: #0a0a0a; color: #ffffff; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        header { background: rgba(15, 15, 15, 0.95); border-radius: 20px; padding: 40px; margin-bottom: 30px; }
        .btn-primary, .btn-secondary, .btn-warning, .btn-danger, .btn-info, .btn-success { 
            padding: 15px 30px; border-radius: 12px; cursor: pointer; margin: 5px;
            background: linear-gradient(135deg, #00d4ff, #5b86e5); color: white; border: none;
        }
    </style>
    <script>
        document.documentElement.style.setProperty('opacity', '1', 'important');
        document.body.style.setProperty('opacity', '1', 'important');
    </script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
        import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js';
        import { getDatabase, ref, set, get, onValue, push } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyDSDK0NfVSs_VQb3TnrixiJbOpTsmoUMvU",
            authDomain: "misterpips-b71fb.firebaseapp.com",
            databaseURL: "https://misterpips-b71fb-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "misterpips-b71fb",
            storageBucket: "misterpips-b71fb.firebasestorage.app",
            messagingSenderId: "574231126409",
            appId: "1:574231126409:web:b7ed93ac4ea62e247dc158"
        };
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);
        
        window.firebaseDB = db;
        window.firebaseAuth = auth;
        window.dbRef = ref;
        window.dbGet = get;
        window.dbSet = set;
        window.onValue = onValue;
        window.push = push;
        
        onAuthStateChanged(auth, (user) => {
            if (!user) {
                window.location.href = 'index.html';
            } else {
                sessionStorage.setItem('firebaseUID', user.uid);
                sessionStorage.setItem('userEmail', user.email);
            }
        });
    </script>
</head>
<body>
    <script>
        // Forcer l'affichage immédiatement
        document.body.style.opacity = '1';
        document.body.style.visibility = 'visible';
        document.documentElement.style.opacity = '1';
        
        // Redirection mobile
        if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||
           (window.innerWidth <= 768 && window.innerHeight <= 1024)) {
            const firebaseUID = sessionStorage.getItem('firebaseUID');
            if (firebaseUID) {
                window.location.href = 'mobile-dashboard.html';
            }
        }
    </script>
    
    <div class="container">
        <header>
            <h1>Dashboard Trading</h1>
            <button id="vipHomeBtn" class="btn-vip-home">🏠 Accueil VIP</button>
            <div class="account-selector">
                <label for="accountSelect">💼 Compte:</label>
                <select id="accountSelect">
                    <option value="compte1">Compte Principal</option>
                    <option value="compte2">Compte Démo</option>
                    <option value="compte3">Compte Swing</option>
                </select>
                <button id="addAccountBtn" class="btn-info">+ Nouveau</button>
                <button id="deleteAccountBtn" class="btn-danger">🗑️ Supprimer</button>
                <div id="syncStatus">🔄 Sync Auto</div>
            </div>
            <div class="stats-overview">
                <div class="stat-card">
                    <h3>Capital</h3>
                    <span id="capital">$1000</span>
                </div>
                <div class="stat-card">
                    <h3>Winrate</h3>
                    <span id="winRate">0%</span>
                </div>
                <div class="stat-card">
                    <h3>P&L Total</h3>
                    <span id="totalPnL">$0</span>
                </div>
                <div class="stat-card">
                    <h3>Trades Ouverts</h3>
                    <span id="openTrades">0</span>
                </div>
                <div class="stat-card">
                    <h3>Total Trades</h3>
                    <span id="totalTrades">0</span>
                </div>
            </div>
        </header>

        <main>
            <div class="actions">
                <button id="newTradeBtn" class="btn-primary">Nouveau Trade</button>
                <button id="historyTradeBtn" class="btn-success">📅 Trade Passé</button>
                <button id="settingsBtn" class="btn-secondary">⚙️ Paramètres</button>
                <button id="closeTradeBtn" class="btn-warning">Clôturer Trade</button>
                <button id="exportBtn" class="btn-info">📊 Export Excel</button>
            </div>

            <div class="charts-section">
                <div class="chart-container">
                    <h3>📈 Performance Cumulative</h3>
                    <canvas id="performanceChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>🎯 Taux de Réussite</h3>
                    <canvas id="winRateChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>📊 Performance Mensuelle</h3>
                    <canvas id="monthlyChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>💰 Performance Totale</h3>
                    <div id="gainsGauge" class="gauge"></div>
                    <div id="gainsValue" class="gauge-value">$0</div>
                    <div id="gainsPercent" class="gauge-percent">0%</div>
                </div>
            </div>
            
            <!-- Plan de Trading -->
            <div class="trading-plan-section">
                <h2>🎯 Plan de Trading & Objectifs</h2>
                <div class="plan-stats">
                    <div class="plan-card">
                        <h4>☀️ Objectif Journalier</h4>
                        <div class="target-info">
                            <div class="target-amount">Cible: <span id="dailyTargetPercent">1%</span> : $<span id="dailyTarget">10</span></div>
                            <div class="target-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="dailyProgressBar"></div>
                                </div>
                                <span id="dailyProgress">0%</span>
                            </div>
                        </div>
                    </div>
                    <div class="plan-card">
                        <h4>📅 Objectif Hebdomadaire</h4>
                        <div class="target-info">
                            <div class="target-amount">Cible: <span id="weeklyTargetPercent">5%</span> : $<span id="weeklyTarget">50</span></div>
                            <div class="target-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="weeklyProgressBar"></div>
                                </div>
                                <span id="weeklyProgress">0%</span>
                            </div>
                        </div>
                    </div>
                    <div class="plan-card">
                        <h4>📊 Objectif Mensuel</h4>
                        <div class="target-info">
                            <div class="target-amount">Cible: <span id="monthlyTargetPercent">15%</span> : $<span id="monthlyTarget">150</span></div>
                            <div class="target-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="monthlyProgressBar"></div>
                                </div>
                                <span id="monthProgress">0%</span>
                            </div>
                        </div>
                    </div>
                    <div class="plan-card">
                        <h4>🏆 Objectif Annuel</h4>
                        <div class="target-info">
                            <div class="target-amount">Cible: <span id="yearlyTargetPercent">200%</span> : $<span id="yearlyTarget">2000</span></div>
                            <div class="target-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="yearlyProgressBar"></div>
                                </div>
                                <span id="yearlyProgress">0%</span>
                            </div>
                        </div>
                    </div>
                    <div class="plan-card">
                        <h4>📊 Rendement Annuel</h4>
                        <div class="target-info">
                            <div class="target-amount">Performance: <span id="annualReturnPercent">0%</span> : $<span id="annualReturn">0</span></div>
                            <div class="target-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="annualReturnBar"></div>
                                </div>
                                <span id="annualReturnProgress">0%</span>
                            </div>
                        </div>
                    </div>
                    <div class="plan-card">
                        <h4>🏆 Classement VIP</h4>
                        <div class="vip-ranking-content">
                            <div class="ranking-list" id="rankingList">
                                <!-- Le classement sera chargé ici -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Calendrier -->
            <div class="calendar-section">
                <h2>📅 Calendrier de Trading</h2>
                <div class="calendar-wrapper">
                    <div class="calendar-controls">
                        <button id="prevMonth" class="btn-secondary">◀</button>
                        <div id="monthYear" class="month-label">Mois</div>
                        <button id="nextMonth" class="btn-secondary">▶</button>
                    </div>
                    <div id="calendarGrid" class="calendar-grid">
                        <!-- Le calendrier sera généré ici -->
                    </div>
                </div>
            </div>

            <div class="trades-history">
                <h2>Historique des Trades</h2>
                <table id="tradesTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Devise</th>
                            <th>Entrée</th>
                            <th>SL</th>
                            <th>TP</th>
                            <th>Lot</th>
                            <th>Résultat</th>
                            <th>Gain/Perte</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </main>
    </div>

    <!-- Modal Trade -->
    <div id="tradeModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="modalContent"></div>
        </div>
    </div>

    <!-- Modal Fullscreen -->
    <div id="fullscreenModal" class="modal fullscreen-modal">
        <div id="fullscreenContent"></div>
    </div>

    <!-- Chat iMessage -->
    <div id="chatToggle" class="chat-toggle">
        💬
        <div id="chatBadge" class="chat-badge">0</div>
    </div>
    
    <div id="chatWindow" class="chat-window">
        <div class="chat-header">
            <h4>💬 Chat VIP</h4>
            <div class="chat-controls">
                <button id="chatSettingsBtn" class="chat-control-btn" title="Paramètres">⚙️</button>
                <button id="closeChatBtn" class="chat-control-btn" title="Fermer">✕</button>
            </div>
            <div id="chatSettings" class="chat-settings">
                <div class="setting-item">
                    <span class="setting-label">🔊 Sons</span>
                    <div id="soundToggle" class="setting-toggle active"></div>
                </div>
                <div class="setting-item">
                    <span class="setting-label">🔔 Notifications</span>
                    <div id="notificationToggle" class="setting-toggle active"></div>
                </div>
                <div class="setting-item">
                    <span class="setting-label">🌙 Mode sombre</span>
                    <div id="darkModeToggle" class="setting-toggle"></div>
                </div>
            </div>
        </div>
        <div id="chatMessages" class="chat-messages">
            <div class="welcome-message">
                <div class="message-bubble other">
                    <div class="message-author">Misterpips Bot</div>
                    Bienvenue dans le chat VIP ! 🚀
                    <div class="message-time">Maintenant</div>
                </div>
            </div>
        </div>
        <div class="chat-input-area">
            <div class="input-container">
                <button id="emojiBtn" class="input-action-btn">😀</button>
                <textarea id="chatInput" class="chat-input" placeholder="Tapez votre message..."></textarea>
                <button id="sendBtn" class="send-btn">➤</button>
            </div>
        </div>
    </div>

    <script src="dashboard.js"></script>
    <script src="pc-clean-fix.js"></script>
    <script src="vip-ranking.js"></script>
    <script src="chat.js"></script>
</body>
</html>