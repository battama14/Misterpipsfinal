<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Trading</title>
    <link rel="stylesheet" href="dashboard-clean.css">
    <link rel="stylesheet" href="chat-input-fix.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#00d4ff">
    <style>
        html, body, .container { 
            opacity: 1 !important; 
            visibility: visible !important; 
            display: block !important;
        }
        /* Styles de base en attendant le CSS */
        body { font-family: 'Inter', sans-serif; background: #0a0a0a; color: #ffffff; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        header { background: rgba(15, 15, 15, 0.95); border-radius: 20px; padding: 40px; margin-bottom: 30px; }
        .btn-primary, .btn-secondary, .btn-warning, .btn-danger, .btn-info, .btn-success { 
            padding: 15px 30px; border-radius: 12px; cursor: pointer; margin: 5px;
            background: linear-gradient(135deg, #00d4ff, #5b86e5); color: white; border: none;
        }
    </style>
    <script>
        document.documentElement.style.setProperty('opacity', '1', 'important');
        document.body.style.setProperty('opacity', '1', 'important');
    </script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
        import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js';
        import { getDatabase, ref, set, get, onValue, push } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyDSDK0NfVSs_VQb3TnrixiJbOpTsmoUMvU",
            authDomain: "misterpips-b71fb.firebaseapp.com",
            databaseURL: "https://misterpips-b71fb-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "misterpips-b71fb",
            storageBucket: "misterpips-b71fb.firebasestorage.app",
            messagingSenderId: "574231126409",
            appId: "1:574231126409:web:b7ed93ac4ea62e247dc158"
        };
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);
        
        window.firebaseDB = db;
        window.firebaseAuth = auth;
        window.dbRef = ref;
        window.dbGet = get;
        window.dbSet = set;
        window.onValue = onValue;
        window.push = push;
        
        // Exposer les modules Firebase
        window.firebaseModules = {
            ref, get, set, onValue, push
        };
        
        onAuthStateChanged(auth, (user) => {
            if (!user) {
                window.location.href = 'index.html';
            } else {
                sessionStorage.setItem('firebaseUID', user.uid);
                sessionStorage.setItem('userEmail', user.email);
                // Nettoyer compl√®tement les anciens pseudos
                sessionStorage.removeItem('userNickname');
                localStorage.removeItem('userNickname');
                localStorage.removeItem('vipNickname');
            }
        });
    </script>
</head>
<body>
    <script>
        // Forcer l'affichage imm√©diatement
        document.body.style.opacity = '1';
        document.body.style.visibility = 'visible';
        document.documentElement.style.opacity = '1';
        
        // Redirection mobile
        if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||
           (window.innerWidth <= 768 && window.innerHeight <= 1024)) {
            const firebaseUID = sessionStorage.getItem('firebaseUID');
            if (firebaseUID) {
                window.location.href = 'mobile-dashboard.html';
            }
        }
    </script>
    
    <div class="container">
        <header>
            <h1>Dashboard Trading</h1>
            <button id="vipHomeBtn" class="btn-vip-home">üè† Accueil VIP</button>
            <div class="account-selector">
                <label for="accountSelect">üíº Compte:</label>
                <select id="accountSelect">
                    <option value="compte1">Compte Principal</option>
                    <option value="compte2">Compte D√©mo</option>
                    <option value="compte3">Compte Swing</option>
                </select>
                <button id="addAccountBtn" class="btn-info">+ Nouveau</button>
                <button id="deleteAccountBtn" class="btn-danger">üóëÔ∏è Supprimer</button>
                <div id="syncStatus">üîÑ Sync Auto</div>
            </div>
            <div class="stats-overview">
                <div class="stat-card">
                    <h3>Capital</h3>
                    <span id="capital">$1000</span>
                </div>
                <div class="stat-card">
                    <h3>Winrate</h3>
                    <span id="winRate">0%</span>
                </div>
                <div class="stat-card">
                    <h3>P&L Total</h3>
                    <span id="totalPnL">$0</span>
                </div>
                <div class="stat-card">
                    <h3>Trades Ouverts</h3>
                    <span id="openTrades">0</span>
                </div>
                <div class="stat-card">
                    <h3>Total Trades</h3>
                    <span id="totalTrades">0</span>
                </div>
            </div>
        </header>

        <main>
            <div class="actions">
                <button id="newTradeBtn" class="btn-primary">Nouveau Trade</button>
                <button id="historyTradeBtn" class="btn-success">üìÖ Trade Pass√©</button>
                <button id="settingsBtn" class="btn-secondary">‚öôÔ∏è Param√®tres</button>
                <button id="closeTradeBtn" class="btn-warning">Cl√¥turer Trade</button>
                <button id="exportBtn" class="btn-info">üìä Export Excel</button>
            </div>

            <div class="charts-section">
                <div class="chart-container">
                    <h3>üìà Performance Cumulative</h3>
                    <canvas id="performanceChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>üéØ Taux de R√©ussite</h3>
                    <canvas id="winRateChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>üìä Performance Mensuelle</h3>
                    <canvas id="monthlyChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>üí∞ Performance Totale</h3>
                    <div id="gainsGauge" class="gauge"></div>
                    <div id="gainsValue" class="gauge-value">$0</div>
                    <div id="gainsPercent" class="gauge-percent">0%</div>
                </div>
            </div>
            
            <!-- Plan de Trading -->
            <div class="trading-plan-section">
                <h2>üéØ Plan de Trading & Objectifs</h2>
                <div class="plan-stats">
                    <div class="plan-card">
                        <h4>‚òÄÔ∏è Objectif Journalier</h4>
                        <div class="target-info">
                            <div class="target-amount">Cible: <span id="dailyTargetPercent">1%</span> : $<span id="dailyTarget">10</span></div>
                            <div class="target-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="dailyProgressBar"></div>
                                </div>
                                <span id="dailyProgress">0%</span>
                            </div>
                        </div>
                    </div>
                    <div class="plan-card">
                        <h4>üìÖ Objectif Hebdomadaire</h4>
                        <div class="target-info">
                            <div class="target-amount">Cible: <span id="weeklyTargetPercent">5%</span> : $<span id="weeklyTarget">50</span></div>
                            <div class="target-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="weeklyProgressBar"></div>
                                </div>
                                <span id="weeklyProgress">0%</span>
                            </div>
                        </div>
                    </div>
                    <div class="plan-card">
                        <h4>üìä Objectif Mensuel</h4>
                        <div class="target-info">
                            <div class="target-amount">Cible: <span id="monthlyTargetPercent">15%</span> : $<span id="monthlyTarget">150</span></div>
                            <div class="target-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="monthlyProgressBar"></div>
                                </div>
                                <span id="monthProgress">0%</span>
                            </div>
                        </div>
                    </div>
                    <div class="plan-card">
                        <h4>üèÜ Objectif Annuel</h4>
                        <div class="target-info">
                            <div class="target-amount">Cible: <span id="yearlyTargetPercent">200%</span> : $<span id="yearlyTarget">2000</span></div>
                            <div class="target-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="yearlyProgressBar"></div>
                                </div>
                                <span id="yearlyProgress">0%</span>
                            </div>
                        </div>
                    </div>
                    <div class="plan-card">
                        <h4>üìä Rendement Annuel</h4>
                        <div class="target-info">
                            <div class="target-amount">Performance: <span id="annualReturnPercent">0%</span> : $<span id="annualReturn">0</span></div>
                            <div class="target-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="annualReturnBar"></div>
                                </div>
                                <span id="annualReturnProgress">0%</span>
                            </div>
                        </div>
                    </div>
                    <div class="plan-card">
                        <h4>üèÜ Classement VIP</h4>
                        <div class="vip-ranking-content">
                            <div class="ranking-list" id="rankingList">
                                <!-- Le classement sera charg√© ici -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Calendrier -->
            <div class="calendar-section">
                <h2>üìÖ Calendrier de Trading</h2>
                <div class="calendar-wrapper">
                    <div class="calendar-controls">
                        <button id="prevMonth" class="btn-secondary">‚óÄ</button>
                        <div id="monthYear" class="month-label">Mois</div>
                        <button id="nextMonth" class="btn-secondary">‚ñ∂</button>
                    </div>
                    <div id="calendarGrid" class="calendar-grid">
                        <!-- Le calendrier sera g√©n√©r√© ici -->
                    </div>
                </div>
            </div>

            <div class="trades-history">
                <h2>Historique des Trades</h2>
                <table id="tradesTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Devise</th>
                            <th>Entr√©e</th>
                            <th>SL</th>
                            <th>TP</th>
                            <th>Lot</th>
                            <th>R√©sultat</th>
                            <th>Gain/Perte</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </main>
    </div>

    <!-- Modal Trade -->
    <div id="tradeModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="modalContent"></div>
        </div>
    </div>

    <!-- Modal Fullscreen -->
    <div id="fullscreenModal" class="modal fullscreen-modal">
        <div id="fullscreenContent"></div>
    </div>


    
    <div style="display: none; position: fixed; bottom: 100px; right: 20px; width: 400px; height: 600px; background: white; border: 2px solid #ccc; border-radius: 15px; z-index: 1001; box-shadow: 0 8px 30px rgba(0,0,0,0.4); color: black;">
        <div style="background: #007bff; color: white; padding: 15px; border-radius: 10px 10px 0 0; display: flex; justify-content: space-between; align-items: center;">
            <h4 style="margin: 0;">üí¨ Chat VIP</h4>
            <div>
                <button style="background: none; border: none; color: white; font-size: 18px; cursor: pointer;" onclick="document.getElementById('chatSettings').style.display = document.getElementById('chatSettings').style.display === 'block' ? 'none' : 'block'">‚öôÔ∏è</button>
                <button style="background: none; border: none; color: white; font-size: 18px; cursor: pointer;" onclick="this.parentElement.parentElement.parentElement.style.display='none'">‚úï</button>
            </div>
        </div>
        <div id="chatSettings" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border: 2px solid #007bff; border-radius: 15px; padding: 20px; box-shadow: 0 8px 30px rgba(0,0,0,0.5); color: black; width: 300px; z-index: 2000;">
            <h3 style="margin: 0 0 15px 0; color: #007bff;">‚öôÔ∏è Param√®tres Chat</h3>
            <div style="margin: 10px 0;">
                <label>üë§ Pseudo:</label><br>
                <input type="text" id="nicknameInput" style="width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 5px; color: black; background: white;" placeholder="Votre pseudo">
                <button onclick="saveNicknameFromChat()" style="background: #007bff; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">Sauver</button>
            </div>
            <div style="margin: 10px 0;">
                <label><input type="checkbox" checked> üîä Sons</label>
            </div>
            <div style="margin: 10px 0;">
                <label><input type="checkbox" checked> üîî Notifications</label>
            </div>
            <div style="margin: 10px 0;">
                <label><input type="checkbox"> üåô Mode sombre</label>
            </div>
            <button onclick="document.getElementById('chatSettings').style.display='none'" style="background: #dc3545; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; margin-top: 10px;">Fermer</button>
        </div>
        <div style="height: 450px; overflow-y: auto; padding: 20px; background: #f8f9fa; border-radius: 0;">
            <div class="welcome-message">
                <div class="message-bubble other">
                    <div class="message-author">Misterpips Bot</div>
                    Bienvenue dans le chat VIP ! üöÄ
                    <div class="message-time">Maintenant</div>
                </div>
            </div>
        </div>
        <div style="padding: 15px; border-top: 1px solid #ddd; display: flex; gap: 10px; align-items: center;">
            <button style="background: #ffc107; border: none; padding: 8px 12px; border-radius: 20px; cursor: pointer; font-size: 16px;">üòÄ</button>
            <input type="text" id="chatInput" placeholder="Tapez votre message..." style="flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 25px; outline: none; font-size: 14px; color: black; background: white;">
            <button id="sendBtn" style="background: #007bff; color: white; border: none; padding: 12px 16px; border-radius: 50%; cursor: pointer; font-size: 16px;">‚û§</button>
        </div>
    </div>


    <script src="dashboard-emergency-fix.js"></script>
    <script src="dashboard.js"></script>

    <script src="chat-simple-fix.js"></script>
    <script src="mobile-fixes-urgent.js"></script>
    <script src="ranking-simple-fix.js"></script>
    <script src="ranking-update-hook.js"></script>
    <script src="dashboard-test-complete.js"></script>
    <script src="nickname-pc-widget.js"></script>
    <script src="chat-toggle-fix.js"></script>
    <script src="chat-widget-fix.js"></script>
    <script src="chat-force-fix.js"></script>
    <script src="chat-direct.js"></script>
    <script src="chat-simple-open.js"></script>
    <script src="chat-final-fix.js"></script>
    <script src="block-old-nickname-systems.js?v=2025"></script>
    <script src="profiles-nickname-system.js?v=2025"></script>
    <script src="settings-modal.js"></script>
    <script>
        // Lier le bouton param√®tres au modal
        document.addEventListener('DOMContentLoaded', () => {
            const settingsBtn = document.getElementById('settingsBtn');
            if (settingsBtn) {
                settingsBtn.addEventListener('click', () => {
                    window.openSettingsModal();
                });
            }
        });
    </script>
</body>
</html>